import React, { useState } from 'react';
import { useSpring, animated } from 'react-spring';

const App = () => {
  const [selectedNiche, setSelectedNiche] = useState('');
  const [customPauta, setCustomPauta] = useState('');
  const [youtubeUrl, setYoutubeUrl] = useState('');
  const [pautas, setPautas] = useState([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [modalContent, setModalContent] = useState({});
  const [modalLoading, setModalLoading] = useState(false);
  const [modalError, setModalError] = useState(null);
  // Estado para controlar a página atual: 'home', 'about', 'contact', 'privacy'.
  const [currentPage, setCurrentPage] = useState('home');

  // Constants for API interaction.
  const API_KEY = ""; // The API key is automatically provided by the Canvas environment.
  const TEXT_MODEL_NAME = 'gemini-2.5-flash-preview-05-20';
  const IMAGE_MODEL_NAME = 'imagen-3.0-generate-002';
  const TEXT_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${TEXT_MODEL_NAME}:generateContent`;
  const IMAGE_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${IMAGE_MODEL_NAME}:predict`;
  const MAX_RETRIES = 3;

  const niches = [
    'Tecnologia', 'Finanças', 'Saúde e Bem-Estar', 'Entretenimento',
    'Reviews', 'Notícias', 'Futebol Brasileiro', 'Futebol Internacional', 'Fofocas'
  ];

  /**
   * Helper function to handle fetch calls with exponential backoff for retries.
   * This makes the application more resilient to temporary API or network issues.
   * @param {string} url The URL to fetch.
   * @param {object} options The fetch options (method, headers, body, etc.).
   * @param {number} retries The number of remaining retries.
   * @returns {Promise<Response>} The fetch response.
   */
  const exponentialBackoffFetch = async (url, options, retries = 0) => {
    try {
      const response = await fetch(url, options);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response;
    } catch (error) {
      if (retries < MAX_RETRIES) {
        const delay = Math.pow(2, retries) * 1000 + Math.random() * 1000;
        await new Promise(res => setTimeout(res, delay));
        return exponentialBackoffFetch(url, options, retries + 1);
      }
      throw error;
    }
  };

  /**
   * Generates pautas for a selected niche based on current trends.
   */
  const handleGeneratePautas = async (niche) => {
    if (loading) return;
    setLoading(true);
    setPautas([]);
    setSelectedNiche(niche);

    const today = new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' });
    const prompt = `Como um analista de tendências, me forneça 15 sugestões de pautas de conteúdo extremamente atuais e relevantes para o nicho de "${niche}". Baseie-se nas notícias e tendências do dia ${today}. Para cada pauta, inclua um título, três palavras-chave de cauda curta e três de cauda longa, e uma breve descrição. Formate a resposta como um array JSON de objetos, onde cada objeto tem as chaves: "niche", "pauta", "title", "short_keywords", "long_keywords".`;

    const payload = {
      contents: [{
        parts: [{ text: prompt }]
      }],
      generationConfig: {
        responseMimeType: "application/json",
        responseSchema: {
          type: "ARRAY",
          items: {
            type: "OBJECT",
            properties: {
              "niche": { "type": "STRING" },
              "pauta": { "type": "STRING" },
              "title": { "type": "STRING" },
              "short_keywords": { "type": "ARRAY", "items": { "type": "STRING" } },
              "long_keywords": { "type": "ARRAY", "items": { "type": "STRING" } }
            },
            "propertyOrdering": ["niche", "pauta", "title", "short_keywords", "long_keywords"]
          }
        }
      }
    };

    try {
      const response = await exponentialBackoffFetch(`${TEXT_API_URL}?key=${API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const result = await response.json();
      const generatedJson = result?.candidates?.[0]?.content?.parts?.[0]?.text;

      if (generatedJson) {
        try {
          const parsedPautas = JSON.parse(generatedJson);
          setPautas(parsedPautas);
        } catch (parseError) {
          console.error("Erro ao analisar JSON:", parseError);
          setPautas([]);
        }
      } else {
        setPautas([]);
      }
    } catch (err) {
      console.error('Erro ao gerar pautas:', err);
      setPautas([]);
    } finally {
      setLoading(false);
    }
  };

  /**
   * Generates a full article for a selected pauta, including the text, an image, and SEO data.
   */
  const handleGenerateArticle = async (pauta) => {
    setModalVisible(true);
    setModalLoading(true);
    setModalError(null);
    setModalContent({});

    const generateText = async () => {
      const textPrompt = `Com base na seguinte pauta, escreva um artigo completo com uma introdução, corpo de texto e uma conclusão. A pauta é: "${pauta.pauta}".`;
      const textPayload = {
        contents: [{
          parts: [{ text: textPrompt }]
        }]
      };
      
      try {
        const response = await exponentialBackoffFetch(`${TEXT_API_URL}?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(textPayload)
        });
        const result = await response.json();
        const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
        return generatedText || "Não foi possível gerar o texto da matéria.";
      } catch (err) {
        console.error("Erro ao gerar texto:", err);
        return "Erro ao gerar o texto da matéria. Por favor, tente novamente.";
      }
    };

    const generateImage = async () => {
      const imagePrompt = `Uma imagem de capa para o artigo: "${pauta.title}". A imagem deve ser vibrante e atraente, adequada para um blog ou notícia.`;
      const imagePayload = { instances: { prompt: imagePrompt }, parameters: { "sampleCount": 1 } };
      
      try {
        const response = await exponentialBackoffFetch(`${IMAGE_API_URL}?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(imagePayload)
        });
        const result = await response.json();
        const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
        return base64Data ? `data:image/png;base64,${base64Data}` : null;
      } catch (err) {
        console.error("Erro ao gerar imagem:", err);
        return null;
      }
    };

    const generateSeoData = async () => {
      const seoPrompt = `Gere uma meta descrição de até 160 caracteres, uma pontuação de 0 a 100 para SEO, e recomendações detalhadas para otimizar o seguinte título e pauta para o Google. Responda apenas com um JSON. Título: "${pauta.title}". Pauta: "${pauta.pauta}". As recomendações devem ser uma lista de 5 itens. O JSON deve ter as chaves: "meta_description", "seo_score", e "recommendations".`;
      const seoPayload = {
        contents: [{
          parts: [{ text: seoPrompt }]
        }],
        generationConfig: {
          responseMimeType: "application/json",
          responseSchema: {
            type: "OBJECT",
            properties: {
              "meta_description": { "type": "STRING" },
              "seo_score": { "type": "NUMBER" },
              "recommendations": { "type": "ARRAY", "items": { "type": "STRING" } }
            },
            "propertyOrdering": ["meta_description", "seo_score", "recommendations"]
          }
        }
      };
      
      try {
        const response = await exponentialBackoffFetch(`${TEXT_API_URL}?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(seoPayload)
        });
        const result = await response.json();
        const generatedJson = result?.candidates?.[0]?.content?.parts?.[0]?.text;

        if (generatedJson) {
          const parsedData = JSON.parse(generatedJson);
          return parsedData;
        }
        return {};
      } catch (err) {
        console.error("Erro ao gerar dados de SEO:", err);
        return {};
      }
    };

    const [articleResult, imageResult, seoResult] = await Promise.allSettled([
      generateText(),
      generateImage(),
      generateSeoData()
    ]);

    const articleText = articleResult.status === 'fulfilled' ? articleResult.value : "Erro ao carregar o artigo.";
    const imageUrl = imageResult.status === 'fulfilled' ? imageResult.value : null;
    const seoData = seoResult.status === 'fulfilled' ? seoResult.value : {};

    setModalContent({
      title: pauta.title,
      article: articleText,
      image: imageUrl,
      meta_description: seoData.meta_description,
      seo_score: seoData.seo_score,
      recommendations: seoData.recommendations || []
    });

    setModalLoading(false);
  };

  /**
   * Handles the generation from a custom pauta input.
   */
  const handleGenerateFromCustomPauta = () => {
    if (!customPauta.trim()) {
      // Use a custom UI element for this instead of a native alert.
      console.warn("Por favor, digite uma pauta para gerar o conteúdo.");
      return;
    }
    const pautaObject = {
      pauta: customPauta.trim(),
      title: customPauta.trim(),
    };
    handleGenerateArticle(pautaObject);
  };

  /**
   * Handles the generation from a YouTube URL.
   * NOTE: This function generates content based on the URL itself and does not
   * access the video's content or transcript due to sandbox environment limitations.
   * The prompt is crafted to instruct the model to infer content from the URL's topic.
   */
  const handleGenerateFromYouTube = () => {
    if (!youtubeUrl.trim()) {
      // Use a custom UI element for this instead of a native alert.
      console.warn("Por favor, digite um URL do YouTube.");
      return;
    }

    const videoTitle = `Artigo baseado em conteúdo do YouTube`;
    const promptFromUrl = `Gere uma matéria completa, incluindo texto, imagem e dados de SEO, para um artigo baseado no conteúdo de um vídeo do YouTube. O URL do vídeo é: ${youtubeUrl}. Foco em extrair o tema principal, pontos-chave e informações relevantes para criar um artigo coerente e informativo.`;
    
    const pautaObject = {
      pauta: promptFromUrl,
      title: videoTitle
    };
    
    handleGenerateArticle(pautaObject);
  };

  // React Spring animation for the cards
  const cardSpring = useSpring({
    from: { opacity: 0, transform: 'translateY(20px)' },
    to: { opacity: 1, transform: 'translateY(0)' },
    config: { tension: 200, friction: 20 },
    delay: 200,
  });

  // React Spring animation for the modal fade-in/out
  const modalSpring = useSpring({
    opacity: modalVisible ? 1 : 0,
    transform: `scale(${modalVisible ? 1 : 0.8})`,
    config: { tension: 300, friction: 20 },
  });

  // SVG for icons
  const ChevronDownIcon = ({ size = 24, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <path d="M6 9l6 6 6-6" />
    </svg>
  );

  const XIcon = ({ size = 28, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <line x1="18" y1="6" x2="6" y2="18" />
      <line x1="6" y1="6" x2="18" y2="18" />
    </svg>
  );

  const CheckCircleIcon = ({ size = 20, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <path d="M22 11.08V12a10 10 0 1 1-5.93-8.08" />
      <polyline points="22 4 12 14.01 9 11.01" />
    </svg>
  );

  const AlertCircleIcon = ({ size = 20, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <circle cx="12" cy="12" r="10" />
      <line x1="12" y1="8" x2="12" y2="12" />
      <line x1="12" y1="16" x2="12.01" y2="16" />
    </svg>
  );

  const FileIcon = ({ size = 24, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
      <polyline points="14 2 14 8 20 8" />
      <line x1="16" y1="13" x2="8" y2="13" />
      <line x1="16" y1="17" x2="8" y2="17" />
      <polyline points="10 9 9 9 8 9" />
    </svg>
  );

  const AnalyseIcon = ({ size = 24, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <rect x="3" y="4" width="18" height="12" rx="2" ry="2" />
      <line x1="12" y1="20" x2="12" y2="16" />
      <line x1="8" y1="20" x2="8" y2="16" />
      <line x1="16" y1="20" x2="16" y2="16" />
    </svg>
  );

  const PencilIcon = ({ size = 24, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
    </svg>
  );

  const YoutubeIcon = ({ size = 24, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" className={className}>
      <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.273 8.35c.068.749.123 1.346.127 1.944-.004.598-.059 1.195-.127 1.944l-.273 1.488c-.068.375-.27.817-.585 1.128-.315.311-.75.508-1.125.577l-1.487.273c-.749.068-1.346.123-1.944.127-.598-.004-1.195-.059-1.944-.127l-1.488-.273c-.375-.069-.817-.266-1.128-.577-.311-.311-.508-.753-.577-1.128l-.273-1.488c-.068-.749-.123-1.346-.127-1.944.004-.598.059-1.195.127-1.944l.273-1.488c.068-.375.27-.817.585-1.128.315-.311.75-.508 1.125-.577l1.487-.273c.749-.068 1.346-.123 1.944-.127.598.004 1.195.059 1.944.127l1.488.273c.375.069.817.266 1.128.577.311.311.508.753.577 1.128l.273 1.488zm-8.873 3.44c.002.399-.02.775-.062 1.139-.026.241-.073.456-.14.646-.067.19-.153.332-.26.425-.107.093-.243.14-.408.14h-.01c-.165 0-.301-.047-.408-.14-.107-.093-.193-.235-.26-.425-.067-.19-.114-.405-.14-.646-.042-.364-.064-.74-.062-1.139-.002-.399.02-1.226.062-1.611.026-.241.073-.456.14-.646.067-.19.153-.332.26-.425.107-.093.243-.14.408-.14h.01c.165 0 .301.047.408.14.107.093.193.235.26.425.067.19.114.405.14.646.042.385.064.761.062 1.139zm-3.265-1.944c.002.399-.02.775-.062 1.139-.026.241-.073.456-.14.646-.067.19-.153.332-.26.425-.107.093-.243.14-.408.14h-.01c-.165 0-.301-.047-.408-.14-.107-.093-.193-.235-.26-.425-.067-.19-.114-.405-.14-.646-.042-.364-.064-.74-.062-1.139-.002-.399.02-1.226.062-1.611.026-.241.073-.456.14-.646.067-.19.153-.332.26-.425.107-.093.243-.14.408-.14h.01c.165 0 .301.047.408.14.107.093.193.235.26.425.067.19.114.405.14.646.042.385.064.761.062 1.139z" />
    </svg>
  );

  // Componente para a página "Quem Somos"
  const AboutUsPage = () => (
    <div className="text-center md:text-left">
      <h1 className="text-3xl md:text-4xl font-bold text-blue-800 mb-6">Quem Somos</h1>
      <p className="text-gray-700 leading-relaxed mb-4">
        O Artigo Fácil foi desenvolvido pela Agência Girafa, especialista em tráfego e monetização digital. A ferramenta nasceu da experiência prática com AdSense, afiliados e SEO, enfrentando diariamente os desafios de publishers, blogueiros e agências que precisam escalar produção sem perder qualidade.
      </p>
      <p className="text-gray-700 leading-relaxed">
        Mais do que gerar textos, o Artigo Fácil entrega crescimento real: artigos otimizados para SEO, prontos para atrair visitantes, aumentar cliques e multiplicar a receita em plataformas de monetização. De horas de trabalho a minutos de resultado — com mais visitas, mais faturamento e mais liberdade para você.
      </p>
    </div>
  );

  // Componente para a página "Contato"
  const ContactPage = () => (
    <div className="text-center">
      <h1 className="text-3xl md:text-4xl font-bold text-blue-800 mb-6">Contato</h1>
      <p className="text-gray-700 leading-relaxed mb-8">
        Para falar conosco, utilize os seguintes canais:
      </p>
      <div className="flex flex-col items-center space-y-4">
        <div className="flex items-center space-x-2 text-gray-700 font-semibold text-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600">
            <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
            <path d="M22 6l-10 7L2 6"></path>
          </svg>
          <span>contato@artigofacil.com</span>
        </div>
        <div className="flex items-center space-x-2 text-gray-700 font-semibold text-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
          </svg>
          <span>+55 43 9966-4548</span>
        </div>
      </div>
    </div>
  );

  // Componente para a página "Política de Privacidade"
  const PrivacyPolicyPage = () => (
    <div className="text-justify">
      <h1 className="text-3xl md:text-4xl font-bold text-blue-800 mb-6 text-center">Política de Privacidade</h1>
      <p className="text-gray-700 leading-relaxed mb-4">
        A sua privacidade é importante para nós. Esta política de privacidade descreve como coletamos, usamos e protegemos as informações que você nos fornece ao utilizar o aplicativo Artigo Fácil.
      </p>
      <h2 className="text-xl md:text-2xl font-bold text-blue-700 mt-8 mb-4">1. Coleta e Uso de Informações</h2>
      <p className="text-gray-700 leading-relaxed mb-4">
        Ao utilizar o Artigo Fácil, você nos fornece informações textuais (pautas, títulos, URLs do YouTube) para a geração de conteúdo. Estas informações são processadas por modelos de inteligência artificial para produzir artigos, imagens e dados de SEO. Não coletamos dados pessoais como nome, e-mail ou informações de pagamento.
      </p>
      <h2 className="text-xl md:text-2xl font-bold text-blue-700 mt-8 mb-4">2. Compartilhamento de Informações</h2>
      <p className="text-gray-700 leading-relaxed mb-4">
        As informações que você insere no aplicativo são enviadas para a API da Google para processamento. Elas são usadas exclusivamente para gerar o conteúdo solicitado e não são compartilhadas com terceiros.
      </p>
      <h2 className="text-xl md:text-2xl font-bold text-blue-700 mt-8 mb-4">3. Segurança</h2>
      <p className="text-gray-700 leading-relaxed mb-4">
        Tomamos medidas razoáveis para proteger as informações que processamos. No entanto, lembre-se de que nenhum método de transmissão pela internet ou de armazenamento eletrônico é 100% seguro.
      </p>
      <h2 className="text-xl md:text-2xl font-bold text-blue-700 mt-8 mb-4">4. Alterações nesta Política</h2>
      <p className="text-gray-700 leading-relaxed">
        Podemos atualizar nossa Política de Privacidade de tempos em tempos. Recomendamos que você revise esta página periodicamente para quaisquer alterações.
      </p>
    </div>
  );

  // Função para renderizar o conteúdo da página com base no estado `currentPage`.
  const renderContent = () => {
    switch (currentPage) {
      case 'about':
        return <AboutUsPage />;
      case 'contact':
        return <ContactPage />;
      case 'privacy':
        return <PrivacyPolicyPage />;
      default:
        return (
          <>
            {/* Header do aplicativo principal */}
            <h1 className="text-3xl md:text-4xl font-bold text-blue-800 mb-4">Gerador de Pautas e Conteúdo com IA</h1>
            <p className="text-gray-600 mb-8 leading-relaxed">
              Escolha como quer gerar seu conteúdo.
            </p>
            
            {/* Main Content Area with three cards */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">

              {/* Card 1: Niche Selection */}
              <animated.div style={cardSpring} className="bg-gray-50 rounded-3xl shadow-lg p-6 flex flex-col items-center">
                <h2 className="text-xl font-bold text-gray-800 mb-4">Gerar por Nicho</h2>
                <p className="text-gray-600 mb-6 text-sm">
                  Gere pautas atuais e otimizadas para SEO com base em um nicho específico.
                </p>
                <div className="relative w-full">
                  <select
                    id="niche-select"
                    value={selectedNiche}
                    onChange={(e) => {
                      const niche = e.target.value;
                      setSelectedNiche(niche);
                      handleGeneratePautas(niche);
                    }}
                    className="w-full p-3 pr-10 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none transition-all"
                  >
                    <option value="">-- Selecione --</option>
                    {niches.map(niche => (
                      <option key={niche} value={niche}>{niche}</option>
                    ))}
                  </select>
                  <div className="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                    <ChevronDownIcon className="text-gray-400" />
                  </div>
                </div>
              </animated.div>

              {/* Card 2: Custom Pauta */}
              <animated.div style={cardSpring} className="bg-gray-50 rounded-3xl shadow-lg p-6 flex flex-col items-center">
                <h2 className="text-xl font-bold text-gray-800 mb-4">Sugerir Pauta Própria</h2>
                <p className="text-gray-600 mb-6 text-sm">
                  Insira sua própria ideia para gerar uma matéria completa.
                </p>
                <textarea
                  value={customPauta}
                  onChange={(e) => setCustomPauta(e.target.value)}
                  placeholder="Digite sua pauta aqui, ex: 'A ascensão da inteligência artificial generativa'."
                  className="w-full p-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all mb-4 h-24 resize-none"
                />
                <button
                  onClick={handleGenerateFromCustomPauta}
                  className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105"
                >
                  <div className="flex items-center justify-center">
                    <PencilIcon size={20} className="mr-2" />
                    Gerar Matéria
                  </div>
                </button>
              </animated.div>

              {/* Card 3: YouTube Link */}
              <animated.div style={cardSpring} className="bg-gray-50 rounded-3xl shadow-lg p-6 flex flex-col items-center">
                <h2 className="text-xl font-bold text-gray-800 mb-4">Gerar de um Link do YouTube</h2>
                <p className="text-gray-600 mb-6 text-sm">
                  Crie uma matéria com base no tema de um vídeo do YouTube.
                </p>
                <input
                  type="text"
                  value={youtubeUrl}
                  onChange={(e) => setYoutubeUrl(e.target.value)}
                  placeholder="Cole o link do YouTube aqui..."
                  className="w-full p-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 transition-all mb-4"
                />
                <button
                  onClick={handleGenerateFromYouTube}
                  className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105"
                >
                  <div className="flex items-center justify-center">
                    <YoutubeIcon size={20} className="mr-2" />
                    Gerar Matéria
                  </div>
                </button>
              </animated.div>
            </div>

            {/* Loading and Pautas section (for Niche selection) */}
            {loading && selectedNiche && (
              <div className="flex justify-center items-center py-8">
                <div className="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"></div>
                <p className="ml-4 text-lg text-gray-600">Gerando pautas...</p>
              </div>
            )}

            {pautas && pautas.length > 0 && (
              <div className="text-left mt-8">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Sugestões de Pautas para "{selectedNiche}"</h2>
                <div className="space-y-4">
                  {pautas.map((pauta, index) => (
                    <div key={index} className="bg-gray-50 p-6 rounded-xl border border-gray-200 transition-all hover:bg-gray-100 flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                      <div className="flex-1">
                        <p className="font-semibold text-gray-800 text-lg">{pauta.title}</p>
                        <p className="text-gray-700 text-sm mt-1">{pauta.pauta}</p>
                      </div>
                      <button
                        onClick={() => handleGenerateArticle(pauta)}
                        className="md:ml-6 flex-shrink-0 w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105"
                      >
                        Gerar Matéria Completa
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </>
        );
    }
  };

  return (
    <div className="bg-gray-100 min-h-screen flex flex-col items-center p-4 font-inter">
      {/* Top Navigation Menu */}
      <nav className="bg-white rounded-full shadow-lg p-3 w-full max-w-lg mb-8 fixed top-4 z-50 transition-all duration-300 transform hover:scale-105">
        <ul className="flex justify-around items-center space-x-4">
          <li>
            <button onClick={() => setCurrentPage('home')} className="text-gray-600 hover:text-blue-600 transition-colors font-semibold">
              Início
            </button>
          </li>
          <li>
            <button onClick={() => setCurrentPage('about')} className="text-gray-600 hover:text-blue-600 transition-colors font-semibold">
              Quem somos
            </button>
          </li>
          <li>
            <button onClick={() => setCurrentPage('contact')} className="text-gray-600 hover:text-blue-600 transition-colors font-semibold">
              Contato
            </button>
          </li>
          <li>
            <button onClick={() => setCurrentPage('privacy')} className="text-gray-600 hover:text-blue-600 transition-colors font-semibold">
              Política de privacidade
            </button>
          </li>
        </ul>
      </nav>

      <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 w-full max-w-6xl text-center mt-20">
        {renderContent()}
      </div>

      {/* Modal for the generated article */}
      {modalVisible && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <animated.div style={modalSpring} className="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-8 relative">
            
            {/* Close button */}
            <button
              onClick={() => setModalVisible(false)}
              className="absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition-colors"
            >
              <XIcon />
            </button>

            {/* Loading state in the modal */}
            {modalLoading ? (
              <div className="flex flex-col items-center justify-center py-12">
                <div className="animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent"></div>
                <p className="mt-4 text-lg text-gray-600 font-semibold">Gerando sua matéria...</p>
                <p className="text-sm text-gray-500 mt-2">Isso pode levar alguns instantes.</p>
              </div>
            ) : (
              // Content of the generated article
              <div className="text-left mt-4">
                <h2 className="text-3xl md:text-4xl font-bold text-blue-800 mb-6">{modalContent.title}</h2>
                
                {modalContent.image && (
                  <div className="w-full mb-6 rounded-2xl overflow-hidden shadow-md">
                    <img src={modalContent.image} alt="Imagem de capa para o artigo" className="w-full h-auto object-cover" />
                  </div>
                )}
                
                {/* Article text content */}
                <div className="prose prose-sm sm:prose-base max-w-none text-gray-700 leading-relaxed mb-6">
                  {modalContent.article && <p className="whitespace-pre-wrap">{modalContent.article}</p>}
                </div>

                {/* SEO section */}
                <div className="bg-gray-50 p-6 rounded-2xl border border-gray-200 mb-6">
                  <h3 className="text-xl font-bold text-gray-800 flex items-center mb-4">
                    <AnalyseIcon className="mr-2 text-blue-600" /> Otimização SEO
                  </h3>
                  <div className="space-y-4">
                    <div>
                      <h4 className="font-bold text-gray-700">Meta Descrição:</h4>
                      <p className="text-gray-600">{modalContent.meta_description || "Não disponível."}</p>
                    </div>
                    <div>
                      <h4 className="font-bold text-gray-700">Pontuação SEO:</h4>
                      <div className="flex items-center mt-1">
                        <span className={`text-xl font-bold ${modalContent.seo_score >= 80 ? 'text-green-600' : modalContent.seo_score >= 50 ? 'text-yellow-600' : 'text-red-600'}`}>
                          {modalContent.seo_score || 0}/100
                        </span>
                        {modalContent.seo_score >= 80 ? (
                          <CheckCircleIcon className="ml-2 text-green-600" />
                        ) : (
                          <AlertCircleIcon className="ml-2 text-yellow-600" />
                        )}
                      </div>
                    </div>
                    <div>
                      <h4 className="font-bold text-gray-700">Recomendações:</h4>
                      <ul className="list-disc list-inside text-gray-600">
                        {modalContent.recommendations && modalContent.recommendations.length > 0 ? (
                          modalContent.recommendations.map((rec, i) => (
                            <li key={i} className="mb-1">{rec}</li>
                          ))
                        ) : (
                          <li>Não foi possível gerar recomendações.</li>
                        )}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </animated.div>
        </div>
      )}
    </div>
  );
};

export default App;
